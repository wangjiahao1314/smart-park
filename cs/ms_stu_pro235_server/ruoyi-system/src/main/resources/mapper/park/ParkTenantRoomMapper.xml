<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.ruoyi.park.mapper.ParkTenantRoomMapper">

    <resultMap id="selectRentingRoomResult" type="com.ruoyi.park.domain.vo.tenant.TenantRentingRoomVo">
        <id property="roomId" column="room_id"/>
        <result property="roomName" column="room_name"/>
    </resultMap>

    <sql id="selectTenantRoomVo">
        SELECT distinct t1.tenant_id,
                        t1.user_id,
                        t3.contract_id,
                        t3.contract_name,
                        t4.room_id,
                        t4.room_name,
                        t1.id_card_number,
                        t1.home_area,
                        t1.address_details,
                        t1.current_address,
                        t4.zone_id,
                        t4.building_id,
                        t4.floor_id,
                        t4.room_img,
                        t4.square_measure,
                        t4.house_type,
                        t4.height,
                        t4.decoration_type,
                        t4.rent,
                        t4.rent_type,
                        t4.property_fee,
                        t4.property_unit,
                        t4.shelf_time,
                        t4.shelf_status,
                        t4.room_introduction
        FROM park_tenant AS t1
                 LEFT JOIN
             park_tenant_room AS t2
             ON
                 t1.tenant_id = t2.tenant_id
                 LEFT JOIN
             park_contract AS t3
             ON
                 t2.contract_id = t3.contract_id
                 LEFT JOIN
             park_room AS t4
             ON
                 t2.room_id = t4.room_id
    </sql>

    <select id="selectRentingRoom" resultMap="selectRentingRoomResult">
        <include refid="selectTenantRoomVo"></include>
        where t1.del_flag = '0' and t2.del_flag = '0' and t3.del_flag = '0' and t4.del_flag = '0' and (t3.contract_type
        = '3' or t3.contract_type = '1')
        <if test="tenantId != null ">
            and t1.tenant_id = #{tenantId}
        </if>
    </select>

    <select id="selectRoomsByTenantIds" resultMap="selectRentingRoomResult">
        <include refid="selectTenantRoomVo"></include>
        where t1.del_flag = '0' and t2.del_flag = '0' and t3.del_flag = '0' and t4.del_flag = '0'
        <if test="tenantIds != null ">
            and t1.tenant_id in
            <foreach collection="tenantIds" item="id" open="(" close=")" separator=",">
                ${id}
            </foreach>

        </if>
    </select>


    <select id="selectRentalApplicationList" resultType="com.ruoyi.park.domain.vo.rental.RentalListVo">
        SELECT distinct t2.tenant_id,
               t3.nick_name,
               t3.phonenumber,
               t7.zone_id,
               t7.zone_name,
               t6.building_id,
               t6.building_name,
               t5.floor_id,
               t5.floor_name,
               t4.room_id,
               t4.room_name,
               t1.rent_start_time,
               t1.rent_end_time,
               t1.approval_status
        FROM park_tenant_room t1
                 LEFT JOIN park_tenant t2 ON t1.tenant_id = t2.tenant_id AND t2.del_flag = '0'
                 LEFT JOIN sys_user t3 ON t2.user_id = t3.user_id AND t3.del_flag = '0'
                 LEFT JOIN park_room t4 ON t1.room_id = t4.room_id AND t4.del_flag = '0'
                 LEFT JOIN park_floor t5 ON t4.floor_id = t5.floor_id AND t5.del_flag = '0'
                 LEFT JOIN park_building t6 ON t5.building_id = t6.building_id AND t6.del_flag = '0'
                 LEFT JOIN park_zone t7 ON t6.zone_id = t7.zone_id AND t7.del_flag = '0'
            ${ew.customSqlSegment}
    </select>
</mapper>